<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPOS Admin</title>

    <!-- Styles -->
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/admin.css">

    <!-- MUST come before menu.js so storageGet() is defined -->
    <script src="/js/storage.js"></script>

    <!-- Menu (uses storageGet + token) -->
    <script defer src="/js/menu.js"></script>

    <!-- Admin-only scripts after menu -->
    <script defer src="/js/adminMeta.js"></script>
    <script defer src="/js/adminUser.js"></script>
    <script defer src="/js/adminMain.js"></script>
    <script defer src="/js/adminUserSearch.js"></script>
    <script defer src="/js/adminRoles.js"></script>
    <script defer src="/js/adminLocations.js"></script>
    <script src="/assistant/assistant.js"></script>
    <script defer src="/js/widgets/adminWidgets.js"></script>
    <link rel="stylesheet" href="/assistant/assistant.css" />

</head>

<body>
    <!-- Menu -->
    <div id="menu"></div>

    <main class="content" style="max-width: 1000px; margin: 2rem auto;">
        <h1 style="margin-bottom: 1rem; color: var(--brand);">Admin Dashboard</h1>

        <!-- Main Tabs -->
        <div class="tabs">
            <div class="tab active" data-target="users">User Management</div>
            <div class="tab" data-target="permissions">Feature Permissions</div>
            <div class="tab" data-target="fields">Field Mapping</div>
            <div class="tab" data-target="dashboard-widgets">Dashboard widgets</div>

        </div>

        <!-- === USER MANAGEMENT MASTER TAB === -->
        <div id="users" class="tab-content active">
            <h2>User Management</h2>

            <!-- Subtabs -->
            <div class="subtabs">
                <div class="subtab active" data-target="sub-users">Users</div>
                <div class="subtab" data-target="sub-roles">Roles</div>
                <div class="subtab" data-target="sub-locations">Locations</div>
            </div>

            <!-- === USERS Subtab === -->
            <div id="sub-users" class="subtab-content active">
                <div class="user-toolbar">
                    <button id="addUserBtn" class="btn-primary">+ Add User</button>

                    <div class="user-search">
                        <select id="searchColumn">
                            <option value="name">Name</option>
                            <option value="email">Email</option>
                            <option value="roles">Role</option>
                            <option value="location">Location</option>
                        </select>
                        <input type="text" id="searchQuery" placeholder="Search users...">
                        <button type="button" id="clearSearch" class="btn-secondary">Clear</button>
                    </div>
                </div>

                <table id="userTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Roles</th>
                            <th>Primary Store</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <!-- User Modal -->
                <div id="userModal" class="modal hidden">
                    <div class="modal-content">
                        <h3 id="modalTitle">Edit User</h3>
                        <div class="modal-body">
                            <form id="userForm">
                                <input type="hidden" name="id" />

                                <div class="form-group">
                                    <label for="firstName">First Name</label>
                                    <input type="text" id="firstName" name="firstName" required>
                                </div>

                                <div class="form-group">
                                    <label for="lastName">Last Name</label>
                                    <input type="text" id="lastName" name="lastName" required>
                                </div>

                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" name="email" required>
                                </div>

                                <div class="form-group">
                                    <label for="roleSelect">Roles</label>
                                    <select name="role_ids" id="roleSelect" multiple></select>
                                </div>

                                <div class="form-group">
                                    <label for="locationSelect">Primary Store</label>
                                    <select name="location_id" id="locationSelect"></select>
                                </div>

                                <div class="form-group">
                                    <label for="profileImage">Profile Image URL</label>
                                    <input type="url" id="profileImage" name="profileImage"
                                        placeholder="https://example.com/avatar.png">
                                </div>

                                <div class="form-group">
                                    <label for="password">Password</label>
                                    <input type="password" id="password" name="password"
                                        placeholder="Leave blank to keep current">
                                </div>

                                <div class="form-group">
                                    <label for="sb_netsuite_token_id">Sandbox Token ID</label>
                                    <input type="password" id="sb_netsuite_token_id" name="sb_netsuite_token_id"
                                        placeholder="************">
                                </div>

                                <label>
                                    NetSuite ID
                                    <input type="text" id="netsuiteId" name="netsuiteId" placeholder="e.g. 12345" />
                                </label>


                                <div class="form-group">
                                    <label for="sb_netsuite_token_secret">Sandbox Token Secret</label>
                                    <input type="password" id="sb_netsuite_token_secret" name="sb_netsuite_token_secret"
                                        placeholder="************">
                                </div>

                                <div class="form-group">
                                    <label for="prod_netsuite_token_id">Production Token ID</label>
                                    <input type="password" id="prod_netsuite_token_id" name="prod_netsuite_token_id"
                                        placeholder="************">
                                </div>

                                <div class="form-group">
                                    <label for="prod_netsuite_token_secret">Production Token Secret</label>
                                    <input type="password" id="prod_netsuite_token_secret"
                                        name="prod_netsuite_token_secret" placeholder="************">
                                </div>
                            </form>
                        </div>

                        <div class="modal-actions">
                            <button type="submit" form="userForm" class="btn-primary">Save</button>
                            <button type="button" id="cancelModal" class="btn-secondary">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === ROLES Subtab === -->
            <div id="sub-roles" class="subtab-content hidden">
                <div class="user-toolbar">
                    <button id="addRoleBtn" class="btn-primary">+ Add Role</button>
                </div>

                <table id="roleTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Role Name</th>
                            <th>Access</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <!-- Role Modal -->
                <div id="roleModal" class="modal hidden">
                    <div class="modal-content">
                        <h3 id="roleModalTitle">Add Role</h3>
                        <div class="modal-body">
                            <form id="roleForm">
                                <label>
                                    Role Name
                                    <input type="text" name="name" required>
                                </label>

                                <label>
                                    Access
                                    <select name="access" id="accessSelect" multiple size="8">
                                        <option value="home">Home</option>
                                        <option value="sales/new">New Sales Order</option>
                                        <option value="quote/new">New Quote</option>
                                        <option value="orders">Order Management</option>
                                        <option value="reports">Reports</option>
                                        <option value="end-of-day">End Of Day</option>
                                        <option value="announcements">Announcements</option>
                                        <option value="admin">Admin</option>
                                    </select>
                                </label>
                            </form>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" form="roleForm" class="btn-primary">Save</button>
                            <button type="button" id="cancelRoleModal" class="btn-secondary">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === LOCATIONS Subtab === -->
            <div id="sub-locations" class="subtab-content hidden">
                <div class="user-toolbar">
                    <button id="addLocationBtn" class="btn-primary">+ Add Location</button>
                </div>

                <table id="locationTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Store Name</th>
                            <th>NetSuite Internal ID</th>
                            <th>invoicing id</th>
                            <th>Interco Customer ID</th>
                            <th>Intercompany Location</th>
                            <th>Account</th>
                            <th>actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <div id="locationModal" class="modal hidden">
                    <div class="modal-content">
                        <h3 id="locationModalTitle">Add Location</h3>
                        <div class="modal-body">
                            <form id="locationForm">
                                <input type="hidden" name="id">
                                <label for="locationName">Store Name</label>
                                <input type="text" id="locationName" name="name" required>
                                <label>
                                    Invoice Location ID
                                    <input type="number" id="invoice_location_id" name="invoice_location_id"
                                        placeholder="e.g. 3" />
                                </label>

                                <label for="netsuiteId">NetSuite Internal ID</label>
                                <input type="text" id="netsuiteId" name="netsuite_internal_id" required>
                                <label>
                                    Intercompany Customer
                                    <input type="text" name="intercompany_customer" />
                                </label>
                                <label>
                                    Intercompany Location
                                    <input type="text" name="intercompany_location" /> <!-- ✅ new -->
                                </label>
                            </form>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" form="locationForm" class="btn-primary">Save</button>
                            <button type="button" id="cancelLocationModal" class="btn-secondary">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === Feature Permissions === -->
        <div id="permissions" class="tab-content hidden">
            <h2>Feature Permissions</h2>
            <p>Configure which features are available to different roles.</p>
        </div>

        <!-- === Field Mapping === -->
        <div id="fields" class="tab-content hidden">
            <h2>Field Mapping</h2>
            <p>Map external data fields to system fields.</p>
        </div>

        <!-- === Field Mapping === -->
        <div id="dashboard-widgets" class="tab-content hidden">
            <h2>Dashboard Widgets</h2>
            <p>Control which roles can view each dashboard widget.</p>

            <!-- Where the cards render -->
            <div id="widgetList" class="widget-admin-grid"></div>

            <!-- Widget Role Modal -->
            <div id="widgetRoleModal" class="modal hidden">
                <div class="modal-content">
                    <h3 id="widgetRoleModalTitle">Edit Widget Access</h3>
                    <div class="modal-body">
                        <form id="widgetRoleForm">
                            <input type="hidden" id="widgetKey" name="widgetKey" />
                            <label for="widgetRoleSelect">Select Roles</label>
                            <select id="widgetRoleSelect" name="roles" multiple size="8"></select>
                        </form>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" form="widgetRoleForm" class="btn-primary">Save</button>
                        <button type="button" id="cancelWidgetRoleModal" class="btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>


    </main>

    <!-- Subtab toggle logic -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".subtab").forEach(tab => {
                tab.addEventListener("click", () => {
                    document.querySelectorAll(".subtab").forEach(t => t.classList.remove("active"));
                    document.querySelectorAll(".subtab-content").forEach(c => c.classList.add("hidden"));
                    tab.classList.add("active");
                    const target = document.getElementById(tab.dataset.target);
                    if (target) target.classList.remove("hidden");
                });
            });
        });
    </script>
</body>

</html>